(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7a5948b8"],{3607:function(e,t,r){"use strict";var a=r("390b"),s=r.n(a);s.a},"390b":function(e,t,r){},b49f:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"add-project-container"},[r("div",{staticClass:"add-project-title"},[e._v("\n    "+e._s(e.isEdit?"编辑项目":"新建项目")+"\n  ")]),e._v(" "),r("el-form",{ref:"projectForm",attrs:{model:e.form,rules:e.projectFormRules,"label-position":"left",inline:!0,"hide-required-asterisk":""}},[r("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[r("el-input",{attrs:{size:"small"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"开始时间",prop:"start_time"}},[r("el-date-picker",{attrs:{size:"small"},model:{value:e.form.start_time,callback:function(t){e.$set(e.form,"start_time",t)},expression:"form.start_time"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"结束时间",prop:"end_time"}},[r("el-date-picker",{attrs:{size:"small"},model:{value:e.form.end_time,callback:function(t){e.$set(e.form,"end_time",t)},expression:"form.end_time"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"项目优先级",prop:"level"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:e.form.level,callback:function(t){e.$set(e.form,"level",t)},expression:"form.level"}},[r("el-option",{attrs:{label:"高",value:3}}),e._v(" "),r("el-option",{attrs:{label:"中",value:2}}),e._v(" "),r("el-option",{attrs:{label:"低",value:1}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"负责人",prop:"person_charge",size:"small",filterable:""}},[r("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:e.form.person_charge,callback:function(t){e.$set(e.form,"person_charge",t)},expression:"form.person_charge"}},e._l(e.allUsers,(function(e){return r("el-option",{key:e.id,attrs:{label:e.username,value:e.id}})})),1)],1),e._v(" "),r("el-form-item",{staticClass:"form-block-item",attrs:{label:"项目描述",prop:"desc",size:"small"}},[r("el-input",{attrs:{type:"textarea",resize:"none",rows:3},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("div",{staticClass:"app-btn app-btn-blue",attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("保 存")]),e._v(" "),r("div",{staticClass:"app-btn app-btn-white",on:{click:e.handleCancel}},[e._v("返 回")])])],1)},s=[],i=(r("ac6a"),r("456d"),r("6b54"),r("db72")),o=(r("7f7f"),function(e){return{name:[{required:!0,trigger:"blur",message:"请输入项目名称"}],start_time:[{validator:function(t,r,a){r||a(new Error("请选择开始时间")),e.form.end_time&&e.$refs.projectForm.validateField("end_time"),a()},trigger:"change"}],end_time:[{validator:function(t,r,a){r?e.form.start_time&&r.getTime()<e.form.start_time.getTime()?a(new Error("结束时间不能早于开始时间")):a():a(new Error("请选择结束时间"))},trigger:"change"}],level:[{required:!0,trigger:"change",message:"请选择项目优先级"}],person_charge:[{required:!0,trigger:"change",message:"请选择负责人"}]}}),l=r("24d2"),n={props:{visible:{type:Boolean,default:!1}},data:function(){return{projectFormRules:o(this),allUsers:this.$store.getters.allUsers,form:{}}},computed:{project:function(){return this.$route.params.project},isEdit:function(){return"projectEdit"===this.$route.name}},created:function(){if(this.isEdit){var e=this.project,t=e.name,r=e.level,a=e.person_charge,s=e.desc,o=e.start_time,l=e.end_time;this.originFormData={name:t,level:r,person_charge:a,desc:s,start_time:o,end_time:l},this.form=Object(i["a"])({},this.originFormData,{start_time:new Date(+this.project.start_time),end_time:new Date(+this.project.end_time)})}},methods:{handleCancel:function(){this.$router.go(-1)},handleConfirm:function(){var e=this;this.$refs.projectForm.validate((function(t){if(t){var r=Object(i["a"])({},e.form,{start_time:e.form.start_time.getTime().toString(),end_time:e.form.end_time.getTime().toString()});if(e.isEdit){var a=e.getDiffData(r);a&&Object(l["j"])(Object(i["a"])({},a,{id:e.project.id})).then((function(t){e.$message({type:"success",message:"更新成功"}),e.$router.go(-1)}))}else Object(l["a"])(r).then((function(t){e.$message({type:"success",message:"新建项目成功"}),e.$router.go(-1),e.$store.dispatch("user/getAllProjects")}))}}))},getDiffData:function(e){var t={};for(var r in this.originFormData)e[r]!==this.originFormData[r]&&(t[r]=e[r]);return!!Object.keys(t)&&t}}},m=n,c=(r("3607"),r("2877")),f=Object(c["a"])(m,a,s,!1,null,"722d6df2",null);t["default"]=f.exports}}]);