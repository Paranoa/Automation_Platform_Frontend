(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0dddbc0a","chunk-7854879d"],{"178b":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n("a745"),i=n.n(a);function s(e){if(i()(e))return e}},"1a00":function(e,t,n){"use strict";var a=n("5f49"),i=n.n(a);i.a},"1af6":function(e,t,n){var a=n("63b6");a(a.S,"Array",{isArray:n("9003")})},"1df6":function(e,t,n){"use strict";function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}n.d(t,"a",(function(){return a}))},"469f":function(e,t,n){n("6c1c"),n("1654"),e.exports=n("7d7b")},"54a1":function(e,t,n){n("6c1c"),n("1654"),e.exports=n("95d5")},"5d73":function(e,t,n){e.exports=n("469f")},"5f49":function(e,t,n){},"768b":function(e,t,n){"use strict";var a=n("178b"),i=n("5d73"),s=n.n(i),r=n("c8bb"),c=n.n(r);function o(e,t){if(c()(Object(e))||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],a=!0,i=!1,r=void 0;try{for(var o,l=s()(e);!(a=(o=l.next()).done);a=!0)if(n.push(o.value),t&&n.length===t)break}catch(u){i=!0,r=u}finally{try{a||null==l["return"]||l["return"]()}finally{if(i)throw r}}return n}}var l=n("1df6");function u(e,t){return Object(a["a"])(e)||o(e,t)||Object(l["a"])()}n.d(t,"a",(function(){return u}))},"7d7b":function(e,t,n){var a=n("e4ae"),i=n("7cd6");e.exports=n("584a").getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return a(t.call(e))}},"95d5":function(e,t,n){var a=n("40c3"),i=n("5168")("iterator"),s=n("481b");e.exports=n("584a").isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||s.hasOwnProperty(a(t))}},a745:function(e,t,n){e.exports=n("f410")},c8bb:function(e,t,n){e.exports=n("54a1")},c8c7:function(e,t,n){"use strict";var a=n("cd1a"),i=n.n(a);i.a},cd1a:function(e,t,n){},cd6e:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"add-interface-container"},[n("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:e.isTabLoading,expression:"isTabLoading"}],attrs:{type:"card",closable:""},on:{"tab-remove":e.handleTabsRemove},model:{value:e.activeTabName,callback:function(t){e.activeTabName=t},expression:"activeTabName"}},e._l(e.envList,(function(t,a){return n("el-tab-pane",{key:t.id,attrs:{label:t.name,name:"tab-"+t.id}},[n("span",{directives:[{name:"loading",rawName:"v-loading",value:t.isNameLoading,expression:"env.isNameLoading"}],staticClass:"tab-label-container",attrs:{slot:"label"},slot:"label"},[n("span",{directives:[{name:"show",rawName:"v-show",value:!t.isEditingName,expression:"!env.isEditingName"}],staticClass:"tab-label-text",on:{click:function(n){return e.editEnvName(t)}}},[e._v(e._s(t.name)+"\n        ")]),e._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.isEditingName,expression:"env.isEditingName"}],staticClass:"tab-label-input"},[n("el-input",{ref:"input-env-name-"+t.id,refInFor:!0,on:{blur:function(n){return e.saveEnvName(t)}},model:{value:t.name,callback:function(n){e.$set(t,"name",n)},expression:"env.name"}})],1),e._v(" "),a===e.envList.length-1?n("span",{staticClass:"tab-label-add",on:{click:e.handleTabsAdd}},[n("i",{staticClass:"el-icon-plus"})]):e._e()]),e._v(" "),n("EnvDetail",{attrs:{"env-data":t.envData,"project-id":e.projectId}})],1)})),1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("div",{staticClass:"app-btn app-btn-blue",attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("保 存")]),e._v(" "),n("div",{staticClass:"app-btn app-btn-white",on:{click:e.handleCancel}},[e._v("返 回")])])],1)},i=[],s=n("db72"),r=(n("7f7f"),n("768b")),c=(n("ac6a"),n("5df3"),n("6b54"),n("7514"),n("24d2")),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"env-detail-main"},e._l(e.envData,(function(t){return n("div",{key:t.name,staticClass:"env-detail-main-content"},[n("h3",{staticClass:"title"},[e._v("服务器\n    ")]),e._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.envs,"row-class-name":e.tableRowClassName}},[n("el-table-column",{attrs:{label:"自定义变量","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.variable)+"\n        ")]}}],null,!0)}),e._v(" "),n("el-table-column",{attrs:{label:"名称","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{attrs:{size:"mini"},model:{value:t.row.name,callback:function(n){e.$set(t.row,"name",n)},expression:"scope.row.name"}})]}}],null,!0)}),e._v(" "),n("el-table-column",{attrs:{label:"值","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{attrs:{size:"mini"},model:{value:t.row.value,callback:function(n){e.$set(t.row,"value",n)},expression:"scope.row.value"}})]}}],null,!0)}),e._v(" "),n("el-table-column",{attrs:{label:"环境描述","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{attrs:{size:"mini"},model:{value:t.row.desc,callback:function(n){e.$set(t.row,"desc",n)},expression:"scope.row.desc"}})]}}],null,!0)})],1)],1)})),0)},l=[],u={props:{envData:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1}},created:function(){},methods:{tableRowClassName:function(e){var t=e.rowIndex;if(t%2===0)return"stripe-row"}}},d=u,v=(n("c8c7"),n("2877")),f=Object(v["a"])(d,o,l,!1,null,"6ddaa51c",null),m=f.exports,b={components:{EnvDetail:m},data:function(){return{activeTabName:"",envList:[],isTabLoading:!1,envTemplate:[]}},computed:{projectId:function(){return this.$route.params.id},activeEnv:function(){var e=this.activeTabName.substring(4);return this.envList.find((function(t){return t.id.toString()===e}))},isEditingEnvName:function(){return this.envList.some((function(e){return e.isEditingName}))}},watch:{activeTabName:{handler:function(e){this.activeEnv&&!this.activeEnv.inited&&this.initEnvTab(this.activeEnv)}}},created:function(){var e=this;Promise.all([this.getProjectEnv(),this.getProjectEnvTemplate()]).then((function(t){var n=Object(r["a"])(t,2),a=n[0],i=n[1];if(e.envList=a,e.envTemplate=i,e.envList.length){var s=e.envList[0];e.activeTabName="tab-".concat(s.id)}else e.addDefaultEnv()}))},methods:{addDefaultEnv:function(){var e={id:"_default",name:"默认环境"};this.envList.push(e),this.activeTabName="tab-_default"},handleTabsAdd:function(e){var t=this,n=function(){var e={id:"_default_new",name:"新增环境",lastModified:"新增环境",isEditingName:!0};t.envList.push(e),t.initEnvTab(e),t.activeTabName="tab-".concat(e.id),setTimeout((function(n){t.$refs["input-env-name-".concat(e.id)][0].focus()}))},a=this.envList[0];"_default"===a.id?this.saveEnvName(a).then((function(e){n()})):n()},handleTabsRemove:function(e){var t=this;if(!this.isEditingEnvName){var n=e.substring(4);if("_default"!==n){var a=this.envList.find((function(e){return e.id.toString()===n})),i=this.envList.indexOf(a);this.$confirm("确认删除环境？").then((function(a){Object(c["d"])({id:n}).then((function(n){t.$message({type:"success",message:"删除成功"}),t.activeTabName===e&&(1===t.envList.length?t.addDefaultEnv():t.activeTabName="tab-".concat(0===i?t.envList[i+1].id:t.envList[i-1].id)),t.envList.splice(i,1)})).catch((function(e){t.$message({type:"error",message:e.message})}))})).catch((function(e){}))}}},editEnvName:function(e){var t=this;this.activeTabName==="tab-".concat(e.id)&&(this.$set(e,"isEditingName",!0),e.lastModified=e.name,setTimeout((function(n){t.$refs["input-env-name-".concat(e.id)][0].focus()})))},saveEnvName:function(e){var t=this;return"_default"===e.id||"_default_new"===e.id?(this.$set(e,"isNameLoading",!0),Object(c["b"])({project:this.projectId,name:e.name}).then((function(n){e.id=n.data.id,t.activeTabName="tab-".concat(e.id)})).catch((function(e){t.$message({message:e.message,type:"error"})})).finally((function(n){t.$set(e,"isNameLoading",!1),t.$set(e,"isEditingName",!1)}))):e.name!==e.lastModified?(this.$set(e,"isNameLoading",!0),Object(c["k"])({id:e.id},{project:this.projectId,name:e.name}).then((function(e){})).catch((function(e){t.$message({message:e.message,type:"error"})})).finally((function(n){t.$set(e,"isNameLoading",!1),t.$set(e,"isEditingName",!1)}))):void this.$set(e,"isEditingName",!1)},getProjectEnv:function(){return Object(c["g"])({project:this.projectId}).then((function(e){return e.data}))},getProjectEnvTemplate:function(){return Object(c["h"])({id:this.projectId}).then((function(e){return[{name:"类型",envs:e.data.map((function(e){var t=e.variable;return{name:"",value:"",desc:"",variable:t}}))}]}))},initEnvTab:function(e){if("_default"===e.id||"_default_new"===e.id)return this.$set(e,"envData",this.getEnvData(this.envTemplate)),e.inited=!0,Promise.resolve();e.inited=!0,this.$set(e,"envData",this.getEnvData(this.envTemplate,e.envcontent))},getEnvData:function(e,t){var n={};return t&&t.forEach((function(e){n[e.variable]=e})),e.map((function(e){return Object(s["a"])({},e,{envs:e.envs.map((function(e){return n[e.variable]?Object(s["a"])({},n[e.variable]):Object(s["a"])({},e)}))})}))},handleCancel:function(){this.$router.go(-1)},handleConfirm:function(){var e=this;this.isTabLoading=!0,this.submitForm().then((function(t){e.$message({type:"success",message:"保存成功"})})).catch((function(t){e.$message({type:"error",message:t.message})})).finally((function(t){e.isTabLoading=!1}))},submitForm:function(){var e=function(e){return e[0].envs};return"_default"===this.activeEnv.id?Object(c["b"])({name:this.activeEnv.name,project:this.projectId,envcontent:e(this.activeEnv.envData)}):Object(c["k"])({id:this.activeEnv.id},{project:this.projectId,envcontent:e(this.activeEnv.envData)})}}},h=b,p=(n("1a00"),Object(v["a"])(h,a,i,!1,null,"5df63348",null));t["default"]=p.exports},f410:function(e,t,n){n("1af6"),e.exports=n("584a").Array.isArray}}]);